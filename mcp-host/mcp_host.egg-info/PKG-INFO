Metadata-Version: 2.4
Name: mcp-host
Version: 0.1.0
Summary: A Python module for hosting and managing MCP servers
Home-page: https://github.com/yourusername/mcp-host
Author: Your Name
Author-email: your.email@example.com
Classifier: Development Status :: 3 - Alpha
Classifier: Intended Audience :: Developers
Classifier: Topic :: Software Development :: Libraries :: Python Modules
Classifier: License :: OSI Approved :: MIT License
Classifier: Programming Language :: Python :: 3
Classifier: Programming Language :: Python :: 3.10
Classifier: Programming Language :: Python :: 3.11
Classifier: Programming Language :: Python :: 3.12
Requires-Python: >=3.10
Description-Content-Type: text/markdown
Provides-Extra: dev
Requires-Dist: pytest>=7.0; extra == "dev"
Requires-Dist: pytest-asyncio>=0.21; extra == "dev"
Requires-Dist: mypy>=1.0; extra == "dev"
Requires-Dist: black>=23.0; extra == "dev"
Requires-Dist: isort>=5.0; extra == "dev"
Dynamic: author
Dynamic: author-email
Dynamic: classifier
Dynamic: description
Dynamic: description-content-type
Dynamic: home-page
Dynamic: provides-extra
Dynamic: requires-python
Dynamic: summary

# MCP Host

A Python module for hosting and managing multiple MCP (Model Context Protocol) servers.

## Features

- **Multi-Server Management**: Start and manage multiple MCP servers from a single configuration
- **Dependency-Based Startup**: Automatically start servers in the correct order based on dependencies
- **Unified Interface**: Access tools, prompts, and resources from all servers through a single API
- **Smart Routing**: Automatic routing of requests to the appropriate server
- **Caching**: Built-in caching for prompts and resources with TTL support
- **Metrics**: Performance metrics collection (request counts, latencies, error rates)
- **Error Handling**: Comprehensive error handling with retry logic
- **Type Safety**: Full type hints throughout the codebase

## Installation

```bash
pip install -e .
```

## Quick Start

### 1. Create a Configuration File

Create an `mcp.json` file:

```json
{
  "servers": {
    "brave-search": {
      "command": "npx",
      "args": ["-y", "@modelcontextprotocol/server-brave-search"],
      "env": {
        "BRAVE_API_KEY": "${BRAVE_API_KEY}"
      }
    },
    "filesystem": {
      "command": "npx",
      "args": ["-y", "@modelcontextprotocol/server-filesystem", "/path/to/directory"]
    }
  }
}
```

### 2. Use the MCP Host

```python
import asyncio
from mcp_host import MCPHost

async def main():
    # Initialize the host
    async with MCPHost(config_path="mcp.json") as host:
        # Get all available tools
        tools = await host.get_tools()
        print(f"Available tools: {[t['name'] for t in tools]}")
        
        # Call a tool
        result = await host.call_tool("brave-search.search", {
            "query": "Python programming"
        })
        print(f"Search results: {result}")
        
        # Get metrics
        metrics = host.get_metrics()
        print(f"Performance metrics: {metrics}")

if __name__ == "__main__":
    asyncio.run(main())
```

## Configuration

### Server Configuration

Each server in `mcp.json` has the following structure:

```json
{
  "servers": {
    "server-name": {
      "command": "command to run",
      "args": ["array", "of", "arguments"],
      "env": {
        "ENV_VAR": "value or ${SYSTEM_VAR}"
      },
      "cwd": "/optional/working/directory",
      "dependencies": ["other-server-name"]
    }
  }
}
```

- **command**: Command to execute (required)
- **args**: Array of command-line arguments (optional)
- **env**: Environment variables (optional, supports ${VAR} expansion)
- **cwd**: Working directory (optional)
- **dependencies**: List of servers that must start before this one (optional)

### Environment Variables

Environment variables in the config are expanded from the system environment:

```json
{
  "env": {
    "API_KEY": "${MY_API_KEY}",
    "DEBUG": "true"
  }
}
```

## API Reference

### MCPHost

Main class for managing MCP servers.

#### Methods

##### `async initialize()`
Initialize the host and start all servers.

##### `async shutdown()`
Shutdown all servers and cleanup resources.

##### `async call_tool(name: str, arguments: dict = None, timeout: float = 30.0) -> Any`
Call a tool by name. Supports `"server.tool"` format.

##### `async get_prompt(name: str, arguments: dict = None, timeout: float = 30.0) -> dict`
Get a prompt by name. Results are cached.

##### `async read_resource(uri: str, timeout: float = 30.0) -> dict`
Read a resource by URI. Supports `"server:path"` format.

##### `async get_tools(server: str = None) -> List[dict]`
Get all available tools, optionally filtered by server.

##### `async get_prompts(server: str = None) -> List[dict]`
Get all available prompts, optionally filtered by server.

##### `async get_resources(server: str = None) -> List[dict]`
Get all available resources, optionally filtered by server.

##### `get_servers() -> List[dict]`
Get information about all running servers.

##### `get_metrics(server: str = None) -> dict`
Get performance metrics, optionally filtered by server.

##### `register_notification_handler(notification_type: str, handler: Callable)`
Register a handler for server notifications.

## Architecture

The MCP Host consists of several components:

- **ConfigLoader**: Loads and validates configuration, handles dependency resolution
- **ServerManager**: Manages server processes and lifecycle
- **CapabilityRegistry**: Stores and queries server capabilities
- **RequestRouter**: Routes requests to appropriate servers with retry logic
- **Cache**: Caches responses with TTL and LRU eviction
- **MetricsCollector**: Collects performance metrics

## Error Handling

The module provides comprehensive error handling:

```python
from mcp_host import (
    MCPHostError,           # Base exception
    ConfigurationError,     # Config file errors
    ServerStartupError,     # Server startup failures
    ServerUnavailableError, # Server not available
    ValidationError,        # Validation failures
    TimeoutError,           # Request timeouts
    ProtocolError,          # Protocol errors
    RoutingError           # Routing failures
)

try:
    async with MCPHost() as host:
        result = await host.call_tool("tool", {})
except ServerUnavailableError as e:
    print(f"Server {e.server_name} is not available")
except TimeoutError as e:
    print(f"Request timed out after {e.timeout_seconds}s")
except MCPHostError as e:
    print(f"MCP Host error: {e}")
```

## Examples

See the `examples/` directory for more examples:

- `simple_host.py`: Basic usage example
- `mcp.json.example`: Example configuration file

## Development

### Running Tests

```bash
pytest tests/
```

### Type Checking

```bash
mypy mcp_host/
```

## License

MIT License

## Contributing

Contributions are welcome! Please open an issue or submit a pull request.
